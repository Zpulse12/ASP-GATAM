stages:
  - debug
  - deploy

variables:
  BRANCH: technical-33-geautomatiseerde-deployment-omgeving

debug:
  stage: debug
  tags:
    - docker_deployment
  script:
    - echo "Current branch $CI_COMMIT_BRANCH"
    - echo "Pipeline source $CI_PIPELINE_SOURCE"
    - echo "Commit SHA $CI_COMMIT_SHA"
    - echo "Commit TAG $CI_COMMIT_TAG"
    - echo ${CI_PROJECT_DIR}

deploy:
  stage: deploy
  tags:
    - docker_deployment
  script:
    - cp /etc/gatam/.env.production ${CI_PROJECT_DIR}/'ASP - GATAM ISW-IP'/.env.production
    - cd './ASP - GATAM ISW-IP/' && docker compose --env-file .\.env.production -f .\docker-compose.staging.yml up -d --build 
  rules:
    - if: '$CI_COMMIT_TAG'
  environment: production
